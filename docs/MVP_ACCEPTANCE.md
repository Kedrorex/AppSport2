# MVP Acceptance Criteria (BDD-lite)

Этот документ фиксирует критерии приемки MVP и список edge cases. Он служит «контрактом» между UI, API и данными и используется как основа для тестов.

## Термины
- **ScheduledExercise**: упражнение, запланированное на дату (workoutDate) с параметрами sets/reps/weight и ссылкой на Exercise.
- **Exercise (каталог)**: справочник упражнений (название, группа мышц и т.п.) — сущность, которая живёт в БД и выбирается при планировании.
- **Дата**: строка формата `YYYY-MM-DD` (локаль пользователя не влияет на хранение/обмен).

## 1) Календарь → список упражнений по дате

### 1.1 Выбор даты (клик по дню)
**Given** пользователь авторизован и находится на странице тренировок/календаря  
**When** пользователь кликает по дню текущего месяца в календаре  
**Then** выбранная дата (selectedDate) обновляется на этот день  
**And** список ниже обновляется и показывает упражнения **только** за выбранную дату  
**And** показывается пустое состояние, если упражнений нет

**Edge cases**
- Клик по дням предыдущего/следующего месяца, отображаемым в сетке календаря:
  - либо запрещён (не кликабелен), либо переводит selectedDate в соответствующую дату (решение фиксируем в коде и покрываем тестом).
- Повторный клик по уже выбранному дню не должен ломать состояние (допускается повторный запрос, но UI не должен мигать/ломаться).

### 1.2 Навигация по месяцам
**Given** открыта сетка календаря за некоторый месяц  
**When** пользователь нажимает «вперёд/назад месяц»  
**Then** сетка календаря показывает правильный месяц/год  
**And** если выбранный день отсутствует в новом месяце (пример: 31 → февраль)  
**Then** selectedDate нормализуется на последнюю валидную дату месяца (28/29)  
**And** список упражнений загружается для нормализованной даты

### 1.3 Ошибки и загрузка
**Given** выполняется загрузка упражнений по выбранной дате  
**Then** UI показывает состояние загрузки (skeleton/loader) и блокирует разрушительные действия при необходимости  
**When** API возвращает ошибку  
**Then** UI показывает понятное сообщение об ошибке  
**And** пользователь может повторить попытку (retry)

### 1.4 Отображение запланированности дней (status/marker)
**Given** открыт календарь за некоторый месяц  
**When** данные summary по диапазону дат загружены  
**Then** каждый день текущего месяца помечается как:
- **planned**: если count > 0
- **empty**: если count = 0 (или отсутствует в ответе summary)

**Edge cases**
- Переключение месяца быстро подряд: не должно приводить к «перемигиванию» маркеров прошлым ответом (нужна защита от race condition/кэш по ключу диапазона).

## 2) Month summary API (агрегация по диапазону дат)

### 2.1 Контракт
**Given** клиент запрашивает `GET /api/exercises/scheduled/summary?from=YYYY-MM-DD&to=YYYY-MM-DD`  
**When** диапазон валиден и from <= to  
**Then** сервер возвращает JSON массив элементов:
- `date: "YYYY-MM-DD"`
- `count: number` (кол-во scheduled упражнений на дату)

**Правила**
- Ответ может содержать только даты, где `count > 0` (клиент трактует отсутствие как 0).
- Диапазон трактуется **включительно** (inclusive).
- Доступ только авторизованному пользователю (данные пользователя из JWT).

### 2.2 Валидация
**When** `from`/`to` отсутствуют или некорректного формата  
**Then** 400 Bad Request  
**When** from > to  
**Then** 400 Bad Request

## 3) CRUD каталога Exercise (упражнения в базе)

### 3.1 Создание упражнения
**Given** пользователь авторизован  
**When** пользователь создаёт новое упражнение (минимум: name)  
**Then** упражнение сохраняется в БД  
**And** отображается в списке упражнений  
**And** становится доступным в модалке добавления в календарь

**Edge cases**
- Пустое имя/слишком длинное имя → 400 с сообщением валидации.
- Дубликаты (одно и то же имя) — решение фиксируем: либо разрешены, либо запрещены (тогда 409/400).

### 3.2 Редактирование упражнения
**Given** упражнение существует  
**When** пользователь изменяет поля и сохраняет  
**Then** изменения сохраняются  
**And** новые данные используются везде, где упражнение отображается/выбирается

### 3.3 Просмотр/поиск
**Given** каталог содержит упражнения  
**When** пользователь открывает страницу упражнений  
**Then** видит список  
**And** может найти упражнение по имени (минимально — клиентский поиск)

## 4) Smoke E2E сценарии (минимум)
- Логин → открыть календарь → выбрать день → увидеть пустое состояние.
- Добавить scheduled exercise на выбранную дату → увидеть в списке → маркер дня planned.
- Удалить scheduled exercise → исчезает из списка → маркер дня обновляется.

